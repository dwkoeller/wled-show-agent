# -----------------------------
# WLED Show Agent v3.4 — example configuration
# -----------------------------
# Copy to .env and edit.
#
# IMPORTANT:
# - Keep this service on your LAN/VLAN (do NOT expose to the public internet).
# - OPENAI_API_KEY is optional; it's only needed for /v1/command.

# --- Required ---
# Base URL of your WLED device (no trailing slash)
WLED_TREE_URL=http://172.16.200.50

# --- Safety / reliability ---
# Max brightness the service will ever set (WLED uses 0..255)
WLED_MAX_BRI=180
# Minimum time (ms) between write calls to WLED (prevents spamming)
WLED_COMMAND_COOLDOWN_MS=250
# HTTP timeout (seconds) for WLED JSON API calls
WLED_HTTP_TIMEOUT_S=2.5

# --- Segments ---
# If your WLED tree uses multiple segments (e.g. 4 outputs = 4 segments), list them here.
# For a 4-segment quarter tree, this is usually 0,1,2,3
WLED_SEGMENT_IDS=0,1,2,3
# If a generated look only targets one segment, replicate it to all segments
WLED_REPLICATE_TO_ALL_SEGMENTS=true

# --- Street-facing quadrant orientation (for 4-segment quarter trees) ---
# These settings let you say things like: "clockwise", "front", "right", etc.
# Example: segment 0 is on street-right, and segment IDs increase counterclockwise as seen from the street.
QUAD_RIGHT_SEGMENT_ID=0
QUAD_ORDER_FROM_STREET=ccw
QUAD_DEFAULT_START_POS=front

# --- Tree geometry (optional; used by some DDP patterns) ---
# These do NOT need to match WLED segments. They describe your physical mega tree layout.
TREE_RUNS=16
TREE_PIXELS_PER_RUN=196
TREE_SEGMENT_LEN=49
TREE_SEGMENTS_PER_RUN=4

# --- DDP streaming (realtime animations) ---
# Host defaults to the hostname part of WLED_TREE_URL if blank.
DDP_HOST=
DDP_PORT=4048
DDP_DESTINATION_ID=1
# DDP packets are chunked by pixels-per-packet; 480 is a safe default on Wi‑Fi.
DDP_MAX_PIXELS_PER_PACKET=480
DDP_FPS_DEFAULT=20
DDP_FPS_MAX=45

# --- OpenAI (optional; enables /v1/command) ---
OPENAI_API_KEY=
OPENAI_MODEL=gpt-5-mini

# --- Agent identity / A2A (agent-to-agent) ---
# Use these when you run multiple agents (tree + rooflines) and want them to coordinate.
AGENT_ID=wled-agent
AGENT_NAME=WLED Agent
AGENT_ROLE=device

# If set, peers must send X-A2A-Key (or Authorization: Bearer ...) to call /v1/a2a/*
A2A_API_KEY=
# Comma-separated peer definitions. Each entry can be:
# - name=http://host:port
# - http://host:port
#
# Example (when using docker compose service names):
# A2A_PEERS=roofline1=http://roofline1:8088,roofline2=http://roofline2:8088
A2A_PEERS=
A2A_HTTP_TIMEOUT_S=2.5

# --- Web UI + local login (optional) ---
# UI is enabled by default at http://<host>:8088/ui
UI_ENABLED=true
#
# If you want a local password + self-issued JWT:
AUTH_ENABLED=false
AUTH_USERNAME=admin
# AUTH_PASSWORD can be plain text, or a PBKDF2 hash:
# AUTH_PASSWORD=pbkdf2_sha256$210000$<salt_b64>$<hash_b64>
AUTH_PASSWORD=
AUTH_JWT_SECRET=
AUTH_JWT_TTL_S=43200
AUTH_JWT_ISSUER=wled-show-agent
AUTH_COOKIE_NAME=wsa_token
# Set true if you terminate TLS in front of this service (recommended).
AUTH_COOKIE_SECURE=false
# Optional: require a 6-digit TOTP code on login (Google Authenticator, 1Password, etc.)
AUTH_TOTP_ENABLED=false
AUTH_TOTP_SECRET=
AUTH_TOTP_ISSUER=wled-show-agent

# --- CORS (optional; useful for local UI dev) ---
# If you run the UI dev server (e.g. Vite on http://localhost:5173) directly against the API,
# set one of these so browsers can call the API cross-origin.
#
# Comma-separated list of allowed origins (exact matches), e.g.:
# CORS_ALLOW_ORIGINS=http://localhost:5173
CORS_ALLOW_ORIGINS=
#
# Or allow via regex (Starlette syntax), e.g.:
# CORS_ALLOW_ORIGIN_REGEX=^https?://localhost(:\\d+)?$
CORS_ALLOW_ORIGIN_REGEX=
#
# Credentials (cookies / Authorization) require explicit origins (no '*').
CORS_ALLOW_CREDENTIALS=true

# --- Falcon Player (FPP) integration (optional) ---
# If you run Falcon Player on your LAN and want this agent to start/stop playlists or trigger events:
# FPP_BASE_URL=http://172.16.200.20
FPP_BASE_URL=
FPP_HTTP_TIMEOUT_S=2.5
# Optional extra headers (JSON object) sent on every request to FPP (auth, etc).
# Example: FPP_HEADERS_JSON={"Authorization":"Bearer <token>"}
FPP_HEADERS_JSON=

# --- Data directory inside container (normally leave this alone) ---
DATA_DIR=/data

# --- Pack ingestion limits (UI: Tools → Packs) ---
# Limits are enforced when uploading/unpacking zip packs via PUT /v1/packs/ingest.
PACK_MAX_FILES=4000
PACK_MAX_UNPACKED_MB=500

# --- Database (optional; MySQL) ---
# If set, job history + small UI state (scheduler config, runtime_state) are also persisted in SQL.
# With the provided docker compose service, run:
#   docker compose --profile db up -d --build
#
# Example:
# DATABASE_URL=mysql://wsa:wsa@db:3306/wsa
DATABASE_URL=
#
# These are only used by the optional MySQL container in docker-compose.yml / docker-compose.fleet.yml:
MYSQL_DATABASE=wsa
MYSQL_USER=wsa
MYSQL_PASSWORD=wsa
MYSQL_ROOT_PASSWORD=wsa_root

# --- Non-WLED pixel controllers (ESPixelStick) ---
# Default is WLED mode:
# CONTROLLER_KIND=wled
#
# For an ESPixelStick-style controller (sACN / Art-Net), run the `pixel_main` app and set:
# CONTROLLER_KIND=pixel
# PIXEL_PROTOCOL=e131   # e131 or artnet
# PIXEL_HOST=172.16.200.60
# PIXEL_COUNT=50
# PIXEL_UNIVERSE_START=1
# PIXEL_CHANNELS_PER_UNIVERSE=510
# PIXEL_PORT=5568
# PIXEL_PRIORITY=100
# PIXEL_SOURCE_NAME=Star ESP
